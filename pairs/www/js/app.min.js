/* app-template
*//* v0.0.1
*//* James Tease @whostolemyhat
*//* Last updated: 13-01-2015 */
function Tile(){this.x=0,this.y=0,this.colour="#fff",this.shape="square",this.size=40,this.border=10,this.revealed=!1,this.id=0}var app=app||{};app.bootState={preload:function(){game.load.image("progressBar","/static/pairs/img/menu/progress.png")},create:function(){game.stage.backgroundColor="#591F00",game.physics.startSystem(Phaser.Physics.ARCADE),game.state.start("load")}};var app=app||{},game=new Phaser.Game(320,480,Phaser.AUTO,"game");game.global={score:0},game.state.add("boot",app.bootState),game.state.add("load",app.loadState),game.state.add("menu",app.menuState),game.state.add("play",app.playState),game.state.start("boot");var app=app||{};app.star="star",app.rings="rings",app.hex="hex",app.square="square",app.diamond="diamond",app.circle="circle",app.triangle="triangle",app.navyBlue=Phaser.Color.createColor(60,60,100),app.brown=Phaser.Color.createColor(185,138,122),app.purple=Phaser.Color.createColor(138,76,124),app.russet=Phaser.Color.createColor(174,70,0),app.amber=Phaser.Color.createColor(255,149,22),app.pink=Phaser.Color.createColor(244,160,170),app.chocolate=Phaser.Color.createColor(89,31,0),app.white=Phaser.Color.createColor(255,255,255),app.darkGrey=Phaser.Color.createColor(74,72,73),app.peach=Phaser.Color.createColor(242,216,179),app.allColours=[app.chocolate,app.brown,app.purple,app.russet,app.amber,app.pink,app.navyBlue],app.allShapes=[app.star,app.rings,app.hex,app.square,app.diamond,app.circle,app.triangle],app.pickColour=function(){return app.allColours[Math.floor(Math.random()*app.allColours.length)]},app.pickShape=function(){return app.allShapes[Math.floor(Math.random()*app.allShapes.length)]},app.loadState={preload:function(){var a=game.add.text(game.world.centerX,game.world.centerY-40,"loading...",{font:"30px Arial",fill:"#fff"});a.anchor.setTo(.5,.5);var b=game.add.sprite(game.world.centerX,game.world.centerY,"progressBar");b.anchor.setTo(.5,.5),game.load.setPreloadSprite(b),game.load.spritesheet("mute","/static/pairs/img/menu/muteButton.png",28,22),game.load.spritesheet("play","/static/pairs/img/menu/play.png",200,50),game.load.image("header","/static/pairs/img/menu/header.png"),game.load.image("box","/static/pairs/img/box.png"),game.load.image("pixel","/static/pairs/img/pixel.png"),game.load.image("circle","/static/pairs/img/icons/circle.png"),game.load.image("diamond","/static/pairs/img/icons/diamond.png"),game.load.image("hex","/static/pairs/img/icons/hex.png"),game.load.image("rings","/static/pairs/img/icons/rings.png"),game.load.image("square","/static/pairs/img/icons/square.png"),game.load.image("star","/static/pairs/img/icons/star.png"),game.load.image("triangle","/static/pairs/img/icons/triangle.png"),game.load.image("pause","/static/pairs/img/menu/pause.png")},create:function(){game.state.start("menu")}},$(document).ready(function(){console.log("Running jQuery version",$.fn.jquery)});var app=app||{};app.menuState={create:function(){game.stage.backgroundColor="#f2d8b3",this.finalEmitter=game.add.emitter(game.world.centerX,20,15),this.finalEmitter.makeParticles(app.allShapes),this.finalEmitter.forEach(function(a){var b=app.pickColour();a.tint=Phaser.Color.getColor(b.r,b.g,b.b)}),this.finalEmitter.start(!1,5e3,20);var a=game.add.sprite(game.world.centerX,-160,"header");a.anchor.setTo(.5,0),game.add.tween(a).to({y:0},1e3).easing(Phaser.Easing.Bounce.Out).start(),localStorage.getItem("highScore")||localStorage.setItem("highScore",0);var b=game.add.button(game.world.centerX,game.world.centerY+120,"play",this.start,this,1,0);b.anchor.setTo(.5,.5),b.input.useHandCursor=!0,game.add.tween(b.scale).to({x:1.2,y:1.2},300).to({x:1,y:1},300).delay(1500).loop().start()},start:function(){game.state.start("play")},toggleSound:function(){game.sound.mute=!game.sound.mute,this.muteButton.frame=game.sound.mute?1:0}};var app=app||{};app.playState={create:function(){this.windowWidth=320,this.windowHeight=480,this.revealSpeed=250,this.boxSize=60,this.gapSize=10,this.boardWidth=4,this.boardHeight=6,game.global.totalMoves=0,this.deadAlpha=.4,this.xMargin=(this.windowWidth-this.boardWidth*(this.boxSize+this.gapSize))/2,this.yMargin=(this.windowHeight-this.boardHeight*(this.boxSize+this.gapSize))/2,this.emitter=game.add.emitter(0,0,15),this.emitter.makeParticles("pixel"),this.emitter.setYSpeed(-150,150),this.emitter.setXSpeed(-150,150),this.emitter.gravity=0,this.secondEmitter=game.add.emitter(0,0,15),this.secondEmitter.makeParticles("pixel"),this.secondEmitter.setYSpeed(-150,150),this.secondEmitter.setXSpeed(-170,170),this.secondEmitter.gravity=0,this.star="star",this.rings="rings",this.hex="hex",this.square="square",this.diamond="diamond",this.circle="circle",this.triangle="triangle",this.navyBlue=Phaser.Color.createColor(60,60,100),this.brown=Phaser.Color.createColor(185,138,122),this.purple=Phaser.Color.createColor(138,76,124),this.russet=Phaser.Color.createColor(174,70,0),this.amber=Phaser.Color.createColor(255,149,22),this.pink=Phaser.Color.createColor(244,160,170),this.chocolate=Phaser.Color.createColor(89,31,0),this.white=Phaser.Color.createColor(255,255,255),this.darkGrey=Phaser.Color.createColor(74,72,73),this.peach=Phaser.Color.createColor(242,216,179),this.allColours=[this.chocolate,this.brown,this.purple,this.russet,this.amber,this.pink,this.navyBlue],this.allShapes=[this.star,this.rings,this.hex,this.square,this.diamond,this.circle,this.triangle],this.boxColour=this.darkGrey,this.backgroundColour=this.peach,game.stage.backgroundColor=Phaser.Color.getColor(this.backgroundColour.r,this.backgroundColour.g,this.backgroundColour.b),this.board=this.getRandomisedBoard(),this.tiles=_.flatten(this.board),this.firstSelected="",this.secondSelected="",this.totalRevealed=0,this.animating=!1,game.input.onDown.add(this.boxClick),this.playGame()},playGame:function(){this.drawBoard(this.board,this.revealed),game.time.events.add(1e3,function(){this.coverBoxesAnimation(_.flatten(this.board))},this)},pickColour:function(){return this.allColours[Math.floor(Math.random()*this.allColours.length)]},getRandomisedBoard:function(){for(var a=this.boardWidth*this.boardHeight/2,b=[],c=[],d=0;a>d;d++){for(var e=this.pickColour();_.indexOf(c,e)>-1;)e=this.pickColour();var f=this.allShapes[Math.floor(Math.random()*this.allShapes.length)];c.push(e),c.length===this.allColours.length&&(c=[]),b.push([f,e])}b=b.concat(b),b=_.shuffle(b);for(var g=[],h=0;h<this.boardWidth;h++){for(var i=[],j=0;j<this.boardHeight;j++){var k=b.pop(),l=new Tile;l.x=h,l.y=j,l.shape=k[0],l.colour=k[1],l.id=h+j,i.push(l)}g.push(i)}return g},drawBoard:function(a){var b=app.playState;_.each(_.flatten(a),function(a){var c=b.boxCoordsInPixels(a.x,a.y);a.sprite=game.add.sprite(c.x,c.y,a.shape),a.sprite.tint=Phaser.Color.getColor(a.colour.r,a.colour.g,a.colour.b),a.box=game.add.sprite(c.x,c.y,"box"),a.box.tint=Phaser.Color.getColor(b.darkGrey.r,b.darkGrey.g,b.darkGrey.b),a.box.width=0,a.box.inputEnabled=!0})},boxCoordsInPixels:function(a,b){return{x:a*(this.boxSize+this.gapSize)+this.xMargin,y:b*(this.boxSize+this.gapSize)+this.yMargin}},getShapeAndColour:function(a,b,c){return{shape:a[b][c][0],colour:a[b][c][1]}},getBoxAtPos:function(a,b){var c=app.playState;return _.find(c.tiles,function(d){var e=c.boxCoordsInPixels(d.x,d.y),f=new Phaser.Rectangle(e.x,e.y,c.boxSize,c.boxSize);return f.contains(a,b)?d:!1})},boxClick:function(){var a=app.playState;if(!a.animating){var b=a.getBoxAtPos(game.input.x,game.input.y);b&&(b.revealed||(a.game.add.tween(b.box).to({width:0},a.revealSpeed).start(),game.global.totalMoves+=1,""===a.firstSelected?a.firstSelected=b:""===a.secondSelected&&(a.secondSelected=b,a.animating=!0,a.firstSelected.shape===a.secondSelected.shape&&a.firstSelected.colour===a.secondSelected.colour?(a.tileMatched(),a.totalRevealed+=2,a.totalRevealed===a.tiles.length&&a.win()):game.time.events.add(800,function(){a.coverBoxesAnimation([a.firstSelected,a.secondSelected]),a.firstSelected="",a.secondSelected="",a.animating=!1})),b.revealed=!0))}},coverBoxesAnimation:function(a){var b=app.playState;_.each(a,function(a){var c=100*a.x+50*a.y;this.game.add.tween(a.box).to({width:b.boxSize},b.revealSpeed,Phaser.Easing.Default,!0,c),a.revealed=!1})},win:function(){var a=this;this.finalEmitter=game.add.emitter(0,0,0),this.finalEmitter.width=game.world.width/2,this.finalEmitter.makeParticles("pixel"),this.finalEmitter.setYSpeed(-80,80),this.finalEmitter.setXSpeed(-80,80),this.finalEmitter.gravity=10,this.finalEmitter.x=game.world.centerX,this.finalEmitter.y=0,this.finalEmitter.forEach(function(b){b.tint=Phaser.Color.getColor(a.amber.r,a.amber.g,a.amber.b)}),this.finalEmitter.start(!1,5e3,20),0===parseInt(localStorage.getItem("highScore"),10)&&localStorage.setItem("highScore",game.global.totalMoves),game.global.totalMoves<parseInt(localStorage.getItem("highScore"),10)&&localStorage.setItem("highScore",game.global.totalMoves);var b=game.add.text(game.world.centerX,game.world.centerY-80,"You win!",{font:"40px Merriweather",fill:"#372409",align:"center"});b.anchor.setTo(.5,.5);var c=game.add.text(game.world.centerX,game.world.centerY-20,"Total moves: "+game.global.totalMoves,{font:"20px Merriweather",fill:"#372409",align:"center"});c.anchor.setTo(.5,.5);var d=game.add.text(game.world.centerX,game.world.centerY+20,"Best score: "+localStorage.getItem("highScore"),{font:"20px Merriweather",fill:"#372409",align:"center"});d.anchor.setTo(.5,.5);var e=game.add.button(game.world.centerX,game.world.centerY+100,"play",this.replay,this,1,0);e.anchor.setTo(.5,.5),game.add.tween(e.scale).to({x:1.2,y:1.2},300).to({x:1,y:1},300).delay(1500).loop().start()},replay:function(){game.state.start("play")},tileMatched:function(){var a=this;a.firstSelected.sprite.anchor.setTo(.4,.5),a.firstSelected.sprite.x=a.firstSelected.sprite.x+.4*a.boxSize,a.firstSelected.sprite.y=a.firstSelected.sprite.y+a.boxSize/2,a.secondSelected.sprite.anchor.setTo(.6,.5),a.secondSelected.sprite.x=a.secondSelected.sprite.x+.6*a.boxSize,a.secondSelected.sprite.y=a.secondSelected.sprite.y+a.boxSize/2,game.add.tween(a.firstSelected.sprite).to({alpha:a.deadAlpha,angle:360},300).start(),game.add.tween(a.firstSelected.sprite.scale).to({x:.8,y:.8},300).start(),game.add.tween(a.secondSelected.sprite).to({alpha:a.deadAlpha,angle:-360},300).start(),game.add.tween(a.secondSelected.sprite.scale).to({x:.8,y:.8},300).start(),a.emitter.x=a.firstSelected.sprite.x,a.emitter.y=a.firstSelected.sprite.y,a.emitter.forEach(function(b){b.tint=Phaser.Color.getColor(a.firstSelected.colour.r,a.firstSelected.colour.g,a.firstSelected.colour.b)}),a.emitter.start(!0,350,null,15),a.secondEmitter.x=a.secondSelected.sprite.x,a.secondEmitter.y=a.secondSelected.sprite.y,a.secondEmitter.forEach(function(b){b.tint=Phaser.Color.getColor(a.secondSelected.colour.r,a.secondSelected.colour.g,a.secondSelected.colour.b)}),a.secondEmitter.start(!0,450,null,15),a.firstSelected="",a.secondSelected="",a.animating=!1}},function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();